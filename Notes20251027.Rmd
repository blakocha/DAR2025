---
title: "Notes 2025-10-27"
author: "Blazej Kochanski"
date: "2025-10-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Descriptive statistics in R - correlation / association

## The data

```{r}
library(googlesheets4)
gs4_deauth()
d <- read_sheet("https://docs.google.com/spreadsheets/d/1I1ZJ4I345TfaHvyCCgzMz8pMsfS_J3yi9WcpcrhO6No/edit?usp=sharing", "clean_data")
```

## Pearson correlation coefficient

Measures the **linear** correlation between two quantitative (numeric) variables. See [wikipedia](https://en.wikipedia.org/wiki/Pearson_correlation_coefficient)

Example: correlation between right and left hand span. 

```{r}
plot(d$right_hand_span, d$left_hand_span, pch=16, col=rgb(0,0,0,.4))
cor(d$right_hand_span, d$left_hand_span)
```


Correlation between the height and average hand span?

```{r}
d$avg_hand_span = (d$right_hand_span + d$left_hand_span)/2
cor(d$avg_hand_span, d$height)
```

Correlation between the height and average hand span for males? 

I create a filter (called `mask`). It is a logical vector with `TRUE` when the observation is a `"Male"` and `FALSE` otherwise. [Why do I use double ==? Check what the comparison operator in R are (link)](https://www.geeksforgeeks.org/r-language/what-are-comparison-operators-in-r/)

```{r}
mask <- (d$gender == "Male") 
plot(d$avg_hand_span[mask], d$height[mask], pch=16, col=rgb(0,0,0,.4))
cor(d$avg_hand_span[mask], d$height[mask])
```

Example [from the history by Galton](https://www.rdocumentation.org/packages/HistData/versions/0.9-3/topics/Galton): correlation between the so-called "midparent" height and an adult child height (both in inches):

```{r}
#install.packages("HistData")
library(HistData)
data(Galton)
plot(jitter(Galton$parent), jitter(Galton$child), 
     pch=16, col=rgb(0,0,0,.4))
cor(Galton$parent, Galton$child)
```

## Spearman's rank correlation coefficient

[Spearman's rank correlation coefficient](https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient) is the correlation coefficient based on ranks instead of the raw values.

It can be calculated for quantitative (numeric) and ordinal variables. 

What are ranks? Example. 

| raw values | ranks |
|:---------:|:-----:|
| 5 | 1 |
| 6 | 2 |
| 9 | 3.5 |
| 9 | 3.5 |
| 14 | 6.0 |
| 14 | 6.0 |
| 14 | 6.0 |
| 20 | 8.0 |

Calculate the Spearman's coefficient for height and head_circ. And compare it to the Pearson coefficient. Separately for Males and Females. 

Males: 
Pearson: `r cor(d$height[mask], d$head_circ[mask], use="pairwise.complete.obs")`
Spearman: `r cor(d$height[mask], d$head_circ[mask], method="spearman", use="pairwise.complete.obs")`

Females: 
Pearson: `r cor(d$height[!mask], d$head_circ[!mask])`
Spearman: `r cor(d$height[!mask], d$head_circ[!mask], method="spearman")`

Calculate the Spearman correlation and [Kendall tau](https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient) for head size (`head_circ`) and `stat_likert` variable (The `stat_likert` variable was the answer to the question "Do you think statistics is difficult?" with [Likert scale](https://en.wikipedia.org/wiki/Likert_scale) as the answer):

```{r}
#I will create an ordinal variable "stat" which would be a categorical variable with order (“ordinal variable”)
d$stat <- factor(d$stat_likert, ordered=TRUE, levels=
                   c("Strongly disagree", "Somewhat disagree", 
                     "Neither agree nor disagree", "Somewhat agree", 
                     "Strongly agree" ))

# Then I can calculate the correlation
cor(d$head_circ, as.numeric(d$stat), method="spearman", use="complete.obs")
cor(d$head_circ, as.numeric(d$stat), method="kendall", use="complete.obs")
```

## Two categorical variables - Cramer's V coefficient

Compute the [Cramer's V](https://en.wikipedia.org/wiki/Cram%C3%A9r%27s_V) between eye colour and gender. 

```{r}
d$eye_colour2 <- d$eye_colour
d$eye_colour2[!(d$eye_colour %in% c("Blue", "Brown", "Green"))] <- "Other"
tab <- table(d$gender, d$eye_colour2)
tab
vcd::assocstats(tab)
vcd::assocstats(tab)$cramer
```

## Correlation between binary variable and numeric variable

Example: which correlation is bigger 

- gender and height or 

- gender and hand span?

What could be the measure of the correlation between gender and height?

Idea 1: translate the binary variable into 0/1 and compute the Pearson correlation coefficient. It is called than the [point-biserial correlation coefficient](https://en.wikipedia.org/wiki/Point-biserial_correlation_coefficient)

Idea 2: Cohen's d measure. 

$$d = \frac{\bar{x}_1 - \bar{x}_2} s$$

$$   = \frac{\bar{x}_1 - \bar{x}_2}
{\sqrt{\frac{(n_1-1)s^2_1 + (n_2-1)s^2_2}{n_1+n_2 - 2}}}$$

```{r}
(mean1 = mean(d$height[mask])) # mean for males
(mean2 = mean(d$height[!mask])) # mean for females
(s1 = sd(d$height[mask])) # sd for males
(s2 = sd(d$height[!mask])) # sd for females
(n1 = length(d$height[mask])) # number of males
(n2 = length(d$height[!mask])) # number of females
(cohenD = (mean_males - mean_females)/sqrt(((n1-1)*s1^2+(n2-1)*s2^2)/(n1+n2-2)))
```

```{r}
effsize::cohen.d(d$height~d$gender)$estimate
```

Idea 3: [Probability of superiority](https://en.wikipedia.org/wiki/Probability_of_superiority). Another name is [area under the curve (AUC)](https://en.wikipedia.org/w/index.php?title=Area_under_the_curve_(receiver_operating_characteristic))

```{r}
#install.packages("bigstatsr")
bigstatsr::AUC(d$height, 1*(d$gender=="Male"))
```

It seems that if you sample a man and a woman from this group, the probability of the man being taller is 0.91. 

