---
title: "Notes 2025-10-20"
author: "Blazej Kochanski"
date: "2025-10-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Descriptive statistics in R

## The data

We are using googlesheets4 library. 
If it is not installed on your computer, you should install first (`install.packages("googlesheets4")`). 

```{r, warning=FALSE}
library(googlesheets4)
```

After the library is loaded we turn off the google authorization (no need to log in, the data is available to anyone with the link: https://docs.google.com/spreadsheets/d/1I1ZJ4I345TfaHvyCCgzMz8pMsfS_J3yi9WcpcrhO6No/edit?usp=sharing)

```{r}
library(googlesheets4)
gs4_deauth()
d <- read_sheet("https://docs.google.com/spreadsheets/d/1I1ZJ4I345TfaHvyCCgzMz8pMsfS_J3yi9WcpcrhO6No/edit?usp=sharing", "clean_data")
```

## Distribution of one variable

### Central tendency and positional measures

__Central tendency measures__

- The arithmetic mean
- The median
- The mode (usually: the most frequent value)
- The geometric mean (we use it for example to calculate compound average annual rate of growth)
- [Truncated mean](https://en.wikipedia.org/wiki/Truncated_mean)

Let us take `head_circ` (head circumference) and `fb_friends` (number of Facebook connections) variables from the data and calculate the mean, the median, the geometric mean, the truncated mean (cut 5\% from each tail). 

- __*The arithmetic mean*__

```{r}
# I put na.rm=TRUE to remove the NAs (not-availables, missing values) from the calculation

mean(d$head_circ, na.rm=TRUE)
mean(d$fb_friends, na.rm=TRUE)
```

- __*The median*__

```{r}
median(d$head_circ, na.rm=TRUE)
median(d$fb_friends, na.rm=TRUE)
```

- __*The geometric mean*__

$$ Geom = (x_1 \cdot x_2 \cdot ... \cdot x_n)^{1/n}$$
$$ Geom = \exp\left((\ln(x_1) + \ln(x_2) + ... + \ln(x_n))\cdot\frac{1}{n}\right)$$

$\exp(x)$ means $e^x$ 

Steps:

1) Natural logarithms using `log()`

```{r}
log(d$head_circ)
```

2) The mean (excluding `NA`s)

```{r}
mean(log(d$head_circ), na.rm=TRUE)
```

3) De-log = Geometric mean

```{r}
exp(mean(log(d$head_circ), na.rm=TRUE))
```

The second option is to the `psych` package (`install.packages("psych")` if not present).

```{r}
psych::geometric.mean(d$head_circ)
```

Geometric mean can be calculated only for the data where all elements are postive (greater than zero). There were some people who have no facebook in the survey. So we have to exclude them from the calculation. We calculate the geometric mean using only those with fb_friends>0.

```{r}
psych::geometric.mean(d$fb_friends[d$fb_friends>0])
```

- __*The truncated (trimmed) mean*__

Using `mean` function, with `trim=` parameter. 

```{r}
mean(d$head_circ, na.rm=TRUE, trim=0.05)
mean(d$fb_friends, na.rm=TRUE, trim=0.05)
```

__Positional measures__

Quartiles, deciles, percentiles. They are all called quaNtiles. 

```{r}
# quaRtiles:
quantile(d$head_circ, c(0.25, 0.5, 0.75), na.rm=TRUE)
quantile(d$fb_friends, c(0.25, 0.5, 0.75), na.rm=TRUE)
```

```{r}
# deciles:
(1:9)/10
quantile(d$head_circ, (1:9)/10, na.rm=TRUE)
quantile(d$fb_friends, (1:9)/10, na.rm=TRUE)
```

```{r}
# specific percentiles, for example 65th percentile
quantile(d$head_circ, .65, na.rm=TRUE)
```

### Dispersion measures

- standard deviation
$$s = \sqrt{\frac{1}{n-1}\sum_{i=1}^n \left(x_i-\bar{x}\right)^2}$$
- variance
$$s^2 = \frac{1}{n-1}\sum_{i=1}^n \left(x_i-\bar{x}\right)^2$$
- range (max-min)
- IQR ([interquartile range](https://en.wikipedia.org/wiki/Interquartile_range)), ie. the difference between the upper and the lower quartile: $$Q_3-Q_1$$
- [mean absolute difference](https://en.wikipedia.org/wiki/Mean_absolute_difference), ie. $$\frac{1}{n}\sum_{i=1}^n |x_i-\bar{x}|$$

The standard deviation: `sd` function:

```{r}
sd(d$head_circ, na.rm=TRUE)
sd(d$fb_friends, na.rm=TRUE)
```


The standard deviation: `var` function:

```{r}
var(d$head_circ, na.rm=TRUE)
var(d$fb_friends, na.rm=TRUE)
```

The ranges

```{r}
diff(range(d$head_circ, na.rm=TRUE))
diff(range(d$fb_friends, na.rm=TRUE))
```

The IQR

```{r}
IQR(d$head_circ, na.rm=TRUE)
IQR(d$fb_friends, na.rm=TRUE)
```

The mean absolute difference

If you store the mean (under the nam `M`) you can then compute the absolute differences: `abs(d$head_circ - M)` and the mean of them:

```{r}
M <- mean(d$head_circ, na.rm=TRUE)
mean(abs(d$head_circ - M), na.rm=TRUE)
```

```{r}
M <- mean(d$fb_friends, na.rm=TRUE)
mean(abs(d$fb_friends - M), na.rm=TRUE)
```